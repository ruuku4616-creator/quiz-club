<!DOCTYPE html>
<html lang="ja">
<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>トップページ - SiQ公式サイト</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body>
    <div class="menu-btn" id="menu-btn">
        <span></span>
        <span></span>
        <span></span>
    </div>
    
    <nav class="nav-menu" id="nav-menu">
        <ul>
            <li><a href="index.html">ホーム</a></li>
            <li><a href="active.html">活動報告</a></li>
            <li><a href="quiz.html">SIQ今日の一問</a></li>
            <li><a href="event.html">芝柏杯　特設ページ</a></li>
            <li><a href="blog-list.html">部員ブログ</a></li>
        </ul>
    </nav>
    
    <nav>
        <a href="#" class="logo-area">
            <img id="site-logo-img" src="" alt="ロゴ" style="display: none; height: 50px; width: auto; margin-right: 10px;">
            <div id="logo-q-placeholder" class="logo-placeholder">Q</div>
            <span id="site-logo-text">Shibaura Institute of Quiz</span>
        </a>
    </nav>

    <header>
        <h1 id="main-title">読み込み中...</h1>
        <p id="sub-title">読み込み中...</p>
    </header>

    <div class="container">
        <div class="section">
            <h2>活動紹介</h2>
            <p id="intro-content">読み込み中...</p>
            <a href="/admin/" style="color: var(--accent-green); text-decoration: none; border: 1px solid var(--accent-green); padding: 5px 10px; border-radius: 5px; font-size: 0.8rem;">管理者ログイン</a>
        </div>
<section>
    <h2>活動報告</h2>
    <ul id="blog-list">
        <li>読み込み中...</li>
    </ul>
</section>
    <div class="section">
        <h2>SIQ 今日の一問</h2>
        <div class="quiz-box" onclick="toggleAnswer(this)">
            <p id="top-quiz-question"><strong>Q. 読み込み中...</strong></p>
            <p class="answer" id="top-quiz-answer">A. 読み込み中...</p>
        </div>
        <p style="text-align: right; margin-top: 10px;">
            <a href="quiz.html" style="color: var(--accent-green); text-decoration: none;">過去のアーカイブはこちら →</a>
        </p>
    </div>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
    // --- 1. メニュー開閉 (最優先・独立して動作) ---
    function setupMenu() {
        const menuBtn = document.getElementById('menu-btn');
        const navMenu = document.getElementById('nav-menu');
        
        if (menuBtn && navMenu) {
            menuBtn.onclick = function(e) {
                e.stopPropagation();
                navMenu.classList.toggle('active');
            };
            document.onclick = function(e) {
                if (!navMenu.contains(e.target) && !menuBtn.contains(e.target)) {
                    navMenu.classList.remove('active');
                }
            };
            console.log("Menu setup completed.");
        } else {
            console.error("Menu elements not found.");
        }
    }

    // --- 2. サイト基本データ読み込み ---
    async function loadSiteData() {
        try {
            const response = await fetch('data/index.json');
            if (!response.ok) return;
            const data = await response.json();

            document.getElementById('site-logo-text').innerText = data.site_title_en || "Shibaura Institute of Quiz";
            const mainTitle = data.site_title_jp || "芝浦工業大学柏高等学校クイズ研究会";
            document.getElementById('main-title').innerHTML = mainTitle.replace("学校", "学校<br class='sp-only'>");
            document.getElementById('sub-title').innerText = data.site_subtitle || "";
            document.getElementById('intro-content').innerText = data.intro_text || "";

            const logoImg = document.getElementById('site-logo-img');
            if (data.logo_image) {
                logoImg.src = data.logo_image;
                logoImg.style.display = 'inline-block';
                if(document.getElementById('logo-q-placeholder')) document.getElementById('logo-q-placeholder').style.display = 'none';
            }
        } catch (e) { console.warn("Site data load failed:", e); }
    }

    // --- 3. 活動報告の読み込み ---
    async function loadBlogPosts() {
        const listElement = document.getElementById('blog-list');
        try {
            const response = await fetch('data/blog-list.json');
            if (!response.ok) throw new Error("File not found");
            const posts = await response.json();
            listElement.innerHTML = '';
            posts.forEach(postName => {
                const li = document.createElement('li');
                li.innerHTML = `<a href="blog.html?post=${postName}" style="color: inherit; text-decoration: underline;">${postName}</a>`;
                listElement.appendChild(li);
            });
        } catch (error) {
            listElement.innerHTML = '<li>記事リストを準備中です。</li>';
        }
    }

    // --- 4. 最新クイズの読み込み ---
    async function loadTopQuiz() {
        try {
            const response = await fetch('data/quiz-list.json');
            if (!response.ok) return;
            const quizFiles = await response.json();
            if (quizFiles && quizFiles.length > 0) {
                const quizRes = await fetch(`data/quiz/${quizFiles[0]}.md`);
                if (!quizRes.ok) return;
                let text = await quizRes.text();
                const parts = text.split('---');
                let mainContent = (parts.length >= 3) ? parts[2].trim() : text;
                let answerContent = (parts.length >= 4) ? parts[3].trim() : "回答は未設定です";
                
                document.getElementById('top-quiz-question').innerHTML = marked.parse(mainContent);
                document.getElementById('top-quiz-answer').innerHTML = marked.parse(answerContent);
            }
        } catch (e) { console.warn("Quiz load failed:", e); }
    }

    // --- 5. クイズの答え表示切り替え ---
    function toggleAnswer(element) {
        const answer = element.querySelector('.answer');
        if (answer) {
            answer.style.display = (answer.style.display === 'block') ? 'none' : 'block';
        }
    }

    // --- 実行の順番を厳格に管理 ---
    window.onload = () => {
        setupMenu();      // 何より先にメニューを有効化
        loadSiteData();   // その後にデータ読み込み
        loadBlogPosts();
        loadTopQuiz();
    };
</script>
</body>
</html>



























