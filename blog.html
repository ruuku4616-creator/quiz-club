<!DOCTYPE html>
<html lang="ja">
<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>記事詳細 - SIQ公式サイト</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="menu-btn" id="menu-btn"><span></span><span></span><span></span></div>
    <nav class="nav-menu" id="nav-menu">
        <ul>
            <li><a href="index.html">ホーム</a></li>
            <li><a href="active.html">活動報告</a></li>
            <li><a href="quiz.html">SIQ今日の一問</a></li>
            <li><a href="event.html">芝柏杯 特設ページ</a></li>
            <li><a href="blog-list.html">部員ブログ</a></li>
        </ul>
    </nav>

    <nav>
    <a href="index.html" class="logo-area">
        <img id="site-logo-img" src="" alt="ロゴ" style="display: none; height: 50px; width: auto; margin-right: 10px;">
        <div id="logo-q-placeholder" class="logo-placeholder">Q</div>
        <span id="site-logo-text">Shibaura Institute of Quiz</span>
    </a>
    </nav>

    <div class="container" style="margin-top: 80px;">
        <article class="section">
            <h1 id="post-title" style="color: var(--accent-green);">読み込み中...</h1>
            <div style="margin-bottom: 20px; font-size: 0.9rem; color: #bbb;">
                <span id="post-author" style="margin-right: 15px;"></span>
                <span id="post-date"></span>
            </div>
            <hr style="border: 0; border-top: 1px solid #333; margin: 20px 0;">
            <div id="post-content">記事を読み込んでいます...</div>
        </article>
        
        <div style="margin-top: 20px;">
            <a href="javascript:history.back();" style="color: var(--accent-green); text-decoration: none;">← 前のページへ戻る</a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        // サイト基本データ（ロゴと名称）を読み込む共通関数
async function loadSiteData() {
    try {
        const response = await fetch('data/index.json');
        const data = await response.json();
        
        // サイト名の反映
        const siteTitle = data.site_title || "Shibaura Institute of Quiz";
        document.getElementById('site-logo-text').innerText = siteTitle;
        
        // ロゴ画像の反映
        const logoImg = document.getElementById('site-logo-img');
        const logoPlaceholder = document.getElementById('logo-q-placeholder');
        
        if (data.logo_image) {
            logoImg.src = data.logo_image;
            logoImg.style.display = 'inline-block';
            if (logoPlaceholder) logoPlaceholder.style.display = 'none';
        }
    } catch (e) {
        console.error("ロゴの読み込みに失敗しました:", e);
    }
}
        async function loadBlogPost() {
    const params = new URLSearchParams(window.location.search);
    const postName = params.get('post');
    const folderName = params.get('folder') || 'blog';

    if (!postName) return;

    try {
        // キャッシュを避けるためにランダムな数字を付けて最新版を取得
        const response = await fetch(`data/${folderName}/${postName}.md?v=${new Date().getTime()}`);
        if (!response.ok) throw new Error("File not found");
        
        const text = await response.text();
        
        // --- 修正ポイント：メタデータと本文を確実に分ける ---
        // 最初の --- と 二番目の --- を探す
        const parts = text.split('---');
        
        if (parts.length >= 3) {
            // parts[1] にタイトルなどの設定が入っている
            const meta = parts[1];
            
            // 各項目を抽出（正規表現でより正確に）
            const titleMatch = meta.match(/title:\s*["']?(.*?)["']?(\n|$)/);
            const authorMatch = meta.match(/author:\s*["']?(.*?)["']?(\n|$)/);
            const dateMatch = meta.match(/date:\s*["']?(.*?)["']?(\n|$)/);

            // タイトルの反映
            document.getElementById('post-title').innerText = titleMatch ? titleMatch[1] : postName;
            
            // 投稿者名の反映
            if (authorMatch) {
                document.getElementById('post-author').innerText = "投稿者: " + authorMatch[1];
            } else {
                document.getElementById('post-author').innerText = ""; // なければ空に
            }

            // 日付の反映
            if (dateMatch) {
                document.getElementById('post-date').innerText = "投稿日: " + dateMatch[1].substring(0, 10);
            }

            // 本文の反映（2番目の --- 以降すべてを本文とする）
            // split('---')で分けた場合、index 2 以降が本文
            const content = parts.slice(2).join('---').trim();
            document.getElementById('post-content').innerHTML = marked.parse(content);
        } else {
            // もし --- がない普通のMarkdownファイルだった場合
            document.getElementById('post-title').innerText = postName;
            document.getElementById('post-content').innerHTML = marked.parse(text);
        }
    } catch (e) {
        console.error(e);
        document.getElementById('post-title').innerText = "読み込みエラー";
        document.getElementById('post-content').innerText = "記事の内容を表示できませんでした。";
    }
}
        

        function setupMenu() {
    const menuBtn = document.getElementById('menu-btn');
    const navMenu = document.getElementById('nav-menu');
    
    if (menuBtn && navMenu) {
        // ボタンクリックで開閉
        menuBtn.onclick = (e) => {
            e.stopPropagation(); // 背景クリック連動を防ぐ
            navMenu.classList.toggle('active');
        };

        // メニュー以外の場所（背景）をタップしたら閉じる
        document.onclick = (e) => {
            if (!navMenu.contains(e.target) && !menuBtn.contains(e.target)) {
                navMenu.classList.remove('active');
            }
        };
    }
}

        window.addEventListener('DOMContentLoaded', () => {
            loadSiteData();   // ロゴ読み込み
            loadBlogPost();   // ★記事詳細ページではこれが必要！
            setupMenu();      // メニュー機能を起動
        });
    </script>
</body>
</html>
