<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>記事詳細 - クイズ研究会</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="menu-btn" id="menu-btn"><span></span><span></span><span></span></div>
    <nav class="nav-menu" id="nav-menu">
        <ul>
            <li><a href="index.html">ホーム</a></li>
            <li><a href="active.html">活動報告</a></li>
            <li><a href="blog-list.html">部員ブログ</a></li>
            <li><a href="quiz.html">SIQ今日の一問</a></li>
            <li><a href="event.html">芝柏杯 特設ページ</a></li>
        </ul>
    </nav>

    <nav>
        <a href="index.html" class="logo-area">
            <div id="logo-q-placeholder" class="logo-placeholder">Q</div>
            <span id="site-logo-text">Shibaura Institute of Quiz</span>
        </a>
    </nav>

    <div class="container" style="margin-top: 80px;">
        <article class="section">
            <h1 id="post-title" style="color: var(--accent-green);">読み込み中...</h1>
            <p id="post-date" style="font-size: 0.9rem; color: #888;"></p>
            <hr style="border: 0; border-top: 1px solid #333; margin: 20px 0;">
            <div id="post-content">記事を読み込んでいます...</div>
        </article>
        
        <div style="margin-top: 20px;">
            <a href="javascript:history.back();" style="color: var(--accent-green); text-decoration: none;">← 前のページへ戻る</a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        async function loadBlogPost() {
            const params = new URLSearchParams(window.location.search);
            const postName = params.get('post');
            // folderが指定されていない場合は 'blog' (活動報告) を見に行く
            const folderName = params.get('folder') || 'blog';

            if (!postName) {
                document.getElementById('post-title').innerText = "記事が指定されていません";
                return;
            }

            try {
                // 指定されたフォルダからファイルを取得
                const response = await fetch(`data/${folderName}/${postName}.md`);
                if (!response.ok) throw new Error("File not found");
                
                const text = await response.text();
                
                // --- 1. メタデータ (--- で囲まれた部分) の処理 ---
                const parts = text.split('---');
                let content = "";
                
                if (parts.length >= 3) {
                    // タイトルをメタデータから抽出
                    const titleMatch = parts[1].match(/title:\s*(.*)/);
                    const dateMatch = parts[1].match(/date:\s*(.*)/);
                    
                    document.getElementById('post-title').innerText = titleMatch ? titleMatch[1].replace(/"/g, '') : postName;
                    if (dateMatch) {
                        document.getElementById('post-date').innerText = "投稿日: " + dateMatch[1].substring(0, 10);
                    }
                    content = parts.slice(2).join('---').trim();
                } else {
                    document.getElementById('post-title').innerText = postName;
                    content = text;
                }

                // --- 2. MarkdownをHTMLに変換 ---
                document.getElementById('post-content').innerHTML = marked.parse(content);

            } catch (e) {
                console.error(e);
                document.getElementById('post-title').innerText = "エラー";
                document.getElementById('post-content').innerText = "記事の読み込みに失敗しました。ファイルが存在するか確認してください。";
            }
        }

        // メニュー開閉用コード
        const menuBtn = document.getElementById('menu-btn');
        const navMenu = document.getElementById('nav-menu');
        menuBtn.addEventListener('click', () => navMenu.classList.toggle('active'));

        // ページ読み込み時に実行
        window.addEventListener('DOMContentLoaded', loadBlogPost);
    </script>
</body>
</html>
