<!DOCTYPE html>
<html lang="ja">
<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>活動報告一覧 - クイズ研究会</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="menu-btn" id="menu-btn"><span></span><span></span><span></span></div>
    <nav class="nav-menu" id="nav-menu">
        <ul>
            <li><a href="index.html">ホーム</a></li>
            <li><a href="active.html">活動報告</a></li>
            <li><a href="quiz.html">SIQ今日の一問</a></li>
            <li><a href="event.html">大会特設</a></li>
            <li><a href="blog-list.html">部員ブログ</a></li>
        </ul>
    </nav>
    <nav>
    <a href="index.html" class="logo-area">
        <img id="site-logo-img" src="" alt="ロゴ" style="display: none; height: 50px; width: auto; margin-right: 10px;">
        <div id="logo-q-placeholder" class="logo-placeholder">Q</div>
        <span id="site-logo-text">Shibaura Institute of Quiz</span>
    </a>
    </nav>

    <div class="container" style="margin-top: 80px;">
        <h1 style="color: var(--accent-green);">活動報告</h1>
        <div class="section">
            <div id="full-list" class="post-grid">読み込み中...</div>
        </div>
    </div>

    <script>
        // サイト基本データ（ロゴと名称）を読み込む共通関数
        async function loadSiteData() {
            try {
                const response = await fetch('data/index.json');
                const data = await response.json();
                
                // サイト名の反映
                const siteTitle = data.site_title || "Shibaura Institute of Quiz";
                document.getElementById('site-logo-text').innerText = siteTitle;
                
                // ロゴ画像の反映
                const logoImg = document.getElementById('site-logo-img');
                const logoPlaceholder = document.getElementById('logo-q-placeholder');
                
                if (data.logo_image) {
                    logoImg.src = data.logo_image;
                    logoImg.style.display = 'inline-block';
                    if (logoPlaceholder) logoPlaceholder.style.display = 'none';
                }
            } catch (e) {
                console.error("ロゴの読み込みに失敗しました:", e);
            }
        }
        async function loadList() {
            const list = document.getElementById('full-list');
            try {
                // 活動報告のリストを取得
                const response = await fetch('data/blog-list.json');
                const posts = await response.json();
                
                list.innerHTML = '';

                // 各記事のデータを順番に読み込んで画像を抽出
                for (const name of posts) {
                    let thumbUrl = ""; // 初期値は空

                    try {
                        // 記事の中身（.md）を取得
                        const postRes = await fetch(`data/blog/${name}.md`);
                        const postText = await postRes.text();
                        
                        // thumbnail: "..." の部分を正規表現で探す
                        const thumbMatch = postText.match(/thumbnail:\s*["']?(.*?)["']?(\n|$)/);
                        if (thumbMatch && thumbMatch[1]) {
                            thumbUrl = thumbMatch[1];
                        }
                    } catch (e) { console.log("画像データ取得失敗:", name); }

                    // カードのHTML作成
                    // ...（画像取得の処理はそのまま）
                    const card = document.createElement('a');
                    card.href = `blog.html?folder=blog&post=${encodeURIComponent(name)}`;
                    card.className = 'post-card';
                    
                    // 画像が存在する場合のみ img タグを生成し、親に 'has-image' クラスをつける
                    let imageHtml = '';
                    if (thumbUrl) {
                        card.classList.add('has-image');
                        imageHtml = `<img src="${thumbUrl}" class="post-card-thumb" alt="${name}">`;
                    }
                    
                    card.innerHTML = `
                    ${imageHtml}
                    <div class="post-card-content">
                    <h3 class="post-card-title">${name}</h3>
                    <div class="post-card-meta">記事を読む →</div>
                    </div>
                    `;
                    list.appendChild(card);
                }
            } catch (e) { 
                list.innerHTML = "<p>記事がありません。</p>"; 
                console.error(e);
            }
        }

        // メニュー開閉設定
        const menuBtn = document.getElementById('menu-btn');
        const navMenu = document.getElementById('nav-menu');
        menuBtn.addEventListener('click', () => navMenu.classList.toggle('active'));

        window.addEventListener('DOMContentLoaded', () => {
            loadSiteData(); // ロゴ読み込み
            loadList();     // 活動報告一覧読み込み（関数名に合わせました）
            // setupMenu() は定義されていないので削除か、別途定義が必要です
        });
    </script>
</body>
</html>








